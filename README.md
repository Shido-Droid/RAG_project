================================================================================
                        RAG Webアプリ 利用手順書
================================================================================

1. はじめに
================================================================================

本ドキュメントは、「RAG Webアプリ」を自身のPCで起動し、利用できるようにする
ための手順書です。
リポジトリの取得から、アプリケーションの起動、動作確認までの流れを記載して
います。


2. 前提環境
================================================================================

以下のいずれかの環境をご用意ください。

  ● パターンA (推奨): Docker Desktop
      - 環境構築が不要で、最も簡単に起動できます。

  ● パターンB: ローカル開発環境
      - Python 3.12 以上
      - Node.js v20 以上
      - Git


3. 導入手順
================================================================================

--------------------------------------------------------------------------------
Step 1: ソースコードの取得
--------------------------------------------------------------------------------

任意の作業フォルダでターミナル（Windowsの場合はPowerShellやコマンド
プロンプト）を開き、以下のコマンドを実行してプロジェクトをダウンロード
します。

    git clone https://github.com/Shido-Droid/RAG_project.git
    cd RAG_project

※ 既にフォルダがある場合は、cd RAG_project の後に git pull を実行して
   最新の状態に更新してください。


--------------------------------------------------------------------------------
Step 2: アプリケーションの起動
--------------------------------------------------------------------------------

環境に合わせて、以下のいずれかの方法で起動してください。


【パターンA】 Dockerで起動する場合 (推奨)
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Dockerがインストールされていれば、以下のコマンドだけで起動できます。
PythonやNode.jsのインストールは不要です。

    docker compose up --build

初回はイメージの作成に数分かかります。
ログが流れ、サーバーが待機状態になったら起動完了です。

起動後、ブラウザで http://localhost:5173 にアクセスしてください。


【パターンB】 ローカル環境で起動する場合
- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

Dockerを使わない場合は、初回のみセットアップが必要です。


(1) バックエンド (Python) の準備
........................................................................

  ▼ 仮想環境の作成

    Mac/Linux (Ubuntu) の場合:
      python3 -m venv .venv

    ※ Ubuntuでエラーが出る場合は以下を実行してください
      sudo apt install python3-venv

    Windowsの場合:
      python -m venv .venv


  ▼ 仮想環境の有効化

    Mac/Linux (Ubuntu) の場合:
      source .venv/bin/activate

    Windowsの場合:
      PowerShell:
        .\.venv\Scripts\Activate.ps1

      コマンドプロンプト:
        .venv\Scripts\activate.bat

    ※ PowerShellでエラーが出る場合は、実行ポリシーの変更が必要な
       場合があります。


  ▼ ライブラリのインストール

    pip install -r requirements.txt


(2) フロントエンド (React) の準備
........................................................................

    cd my-rag-app
    npm install
    cd ..


(3) 起動 (スクリプトを使用)
........................................................................

セットアップ完了後は、以下のスクリプトで一括起動します。

  ▼ Mac/Linux:

    初回のみ実行権限を付与:
      chmod +x start.sh

    アプリ起動:
      ./start.sh


  ▼ Windows:

    start.bat


起動後、ブラウザで http://localhost:5173 にアクセスしてください。


(4) 手動での起動方法 (スクリプトを使わない場合)
........................................................................

手動で起動する場合は、2つのターミナルを開いてそれぞれ実行してください。


  ▼ ターミナル1: バックエンド (APIサーバー)

    仮想環境を有効化:
      Mac/Linux の場合:
        source .venv/bin/activate

      Windows の場合:
        .venv\Scripts\activate

    サーバー起動:
      uvicorn scripts.rag_server:app --reload --port 8000


  ▼ ターミナル2: フロントエンド (画面)

    cd my-rag-app
    npm run dev


起動後、ターミナルに表示されるURL（例: http://localhost:5173）を
ブラウザで開くとアプリが使用できます。


4. アプリの利用
================================================================================

起動に成功したら、ブラウザで以下のURLにアクセスしてください。

  ● Webアプリ: http://localhost:5173
  ● APIドキュメント: http://localhost:8000/docs


5. 終了方法
================================================================================

ターミナルで Ctrl + C を押すとサーバーが停止します。


6. 困ったときは
================================================================================

  ● データの確認:
    登録されているドキュメント数を確認したい場合は、以下のコマンドを
    実行してください。

      Dockerの場合:
        docker compose exec backend python scripts/check_chroma_db.py

      ローカルの場合:
        python scripts/check_chroma_db.py